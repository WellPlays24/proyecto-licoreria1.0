<!-- ============================================
     PRODUCT LIST CLIENTE - RF02
     ============================================ -->

<div class="product-list-container">
  <!-- Header -->
  <div class="page-header">
    <h1>
      <mat-icon>shopping_bag</mat-icon>
      Catálogo de Productos
    </h1>
  </div>

  <!-- Barra de búsqueda y filtros -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-container">
        <!-- Búsqueda -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar productos</mat-label>
          <input matInput [formControl]="searchControl" placeholder="Nombre o descripción">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <!-- Filtro por categoría -->
        <mat-form-field appearance="outline" class="category-field">
          <mat-label>Categoría</mat-label>
          <mat-select [(value)]="selectedCategory" (selectionChange)="onCategoryChange($event.value)">
            <mat-option [value]="null">Todas las categorías</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>category</mat-icon>
        </mat-form-field>

        <!-- Botón limpiar filtros -->
        <button mat-raised-button color="accent" (click)="clearFilters()"
          *ngIf="searchControl.value || selectedCategory">
          <mat-icon>clear</mat-icon>
          Limpiar Filtros
        </button>
      </div>

      <!-- Contador de resultados -->
      <div class="results-count">
        <p>
          Mostrando <strong>{{ filteredProducts.length }}</strong>
          de <strong>{{ products.length }}</strong> productos
        </p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando productos...</p>
  </div>

  <!-- Sin resultados -->
  <mat-card *ngIf="!loading && filteredProducts.length === 0" class="empty-state">
    <mat-card-content>
      <mat-icon>search_off</mat-icon>
      <h2>No se encontraron productos</h2>
      <p>Intenta con otros términos de búsqueda o limpia los filtros</p>
      <button mat-raised-button color="primary" (click)="clearFilters()">
        <mat-icon>refresh</mat-icon>
        Ver todos los productos
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Grid de productos -->
  <div *ngIf="!loading && filteredProducts.length > 0" class="products-grid">
    <mat-card *ngFor="let product of filteredProducts" class="product-card" (click)="viewProduct(product)">

      <!-- Imagen del producto -->
      <div class="product-image-container">
        <img mat-card-image [src]="product.image_url || 'https://via.placeholder.com/300x400?text=Sin+Imagen'"
          [alt]="product.name" class="product-image">

        <!-- Badge de stock -->
        <mat-chip class="stock-badge" [color]="getStockStatus(product.stock).color">
          {{ getStockStatus(product.stock).text }}
        </mat-chip>
      </div>

      <!-- Contenido -->
      <mat-card-content>
        <div class="product-category">
          <mat-icon>category</mat-icon>
          {{ product.category_name }}
        </div>

        <h3 class="product-name">{{ product.name }}</h3>

        <p class="product-description">
          {{ product.description || 'Sin descripción' }}
        </p>

        <div class="product-footer">
          <div class="product-price">
            <span class="price-label">Precio:</span>
            <span class="price-value">${{ product.price }}</span>
          </div>

          <div class="product-actions">
            <button mat-raised-button color="primary" (click)="addToCart(product, $event)"
              [disabled]="product.stock === 0" class="add-to-cart-btn">
              <mat-icon>shopping_cart</mat-icon>
              Añadir
            </button>

            <button mat-icon-button color="accent" (click)="viewProduct(product, $event)"
              [disabled]="product.stock === 0" matTooltip="Ver detalles">
              <mat-icon>visibility</mat-icon>
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>